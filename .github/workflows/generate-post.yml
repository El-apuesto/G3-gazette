name: Generate Weekly Blog Post

on:
  schedule:
    # Run every Monday at 6 AM UTC
    - cron: '0 6 * * 1'
  workflow_dispatch:
    inputs:
      topic:
        description: 'Custom topic for blog post'
        required: false
        type: string
      day:
        description: 'Day of week (monday-sunday)'
        required: false
        type: string
        default: 'monday'

permissions:
  contents: write

jobs:
  generate-post:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Determine post details
        id: post_info
        run: |
          # Get current date and day of week
          DATE=$(date +%Y-%m-%d)
          DAY=$(date +%A | tr '[:upper:]' '[:lower:]')
          
          # Override if manual input provided
          if [ -n "${{ github.event.inputs.day }}" ]; then
            DAY="${{ github.event.inputs.day }}"
          fi
          
          # Set category based on day
          case $DAY in
            monday) CATEGORY="Innovation Monday" ;;
            tuesday) CATEGORY="Tutorial Tuesday" ;;
            wednesday) CATEGORY="Wisdom Wednesday" ;;
            thursday) CATEGORY="Thought Thursday" ;;
            friday) CATEGORY="Feature Friday" ;;
            saturday) CATEGORY="Strategy Saturday" ;;
            sunday) CATEGORY="Summary Sunday" ;;
            *) CATEGORY="General" ;;
          esac
          
          echo "date=$DATE" >> $GITHUB_OUTPUT
          echo "day=$DAY" >> $GITHUB_OUTPUT
          echo "category=$CATEGORY" >> $GITHUB_OUTPUT

      - name: Create post template
        run: |
          DATE="${{ steps.post_info.outputs.date }}"
          CATEGORY="${{ steps.post_info.outputs.category }}"
          TOPIC="${{ github.event.inputs.topic }}"
          
          if [ -z "$TOPIC" ]; then
            TOPIC="Exploring New Horizons in $CATEGORY"
          fi
          
          # Create post filename
          FILENAME="_posts/${DATE}-$(echo $TOPIC | tr '[:upper:]' '[:lower:]' | tr ' ' '-' | tr -cd '[:alnum:]-').md"
          
          # Create post content
          cat > "$FILENAME" << EOF
          ---
          layout: post
          title: "$TOPIC"
          date: $DATE 09:00:00 -0600
          category: $CATEGORY
          author: Grant Genie Team
          featured_image: /assets/images/placeholder-${DATE}.jpg
          tags: [${CATEGORY,,}, research, insights]
          excerpt: "Discover insights and perspectives on $TOPIC in today's $CATEGORY post."
          ---

          ## Introduction

          Welcome to this week's $CATEGORY post! Today we're exploring $TOPIC.

          <!-- TODO: This is a template. Replace with actual content generated by Perplexity -->

          ## Main Content

          [Your researched content goes here]

          ## Key Takeaways

          - Point 1
          - Point 2
          - Point 3

          ## Conclusion

          [Conclusion goes here]

          ---

          *What are your thoughts on this topic? Share your insights in the comments below!*
          EOF
          
          echo "Created post: $FILENAME"

      - name: Commit and push
        run: |
          git config user.name "G3-Bot"
          git config user.email "bot@grantgenie.com"
          git add _posts/
          git commit -m "Auto-generate blog post for ${{ steps.post_info.outputs.date }}"
          git push